function CrownPeakSearch(n){function tt(n){n&&(typeof n=="string"?r=n:(n.collection&&(r=n.collection),n.endpoint&&(v=n.endpoint),n.facets&&(e=n.facets),n.handler&&(p=n.handler),(n.highlight||n.highlight==!1)&&(c=n.highlight),n.highlightSeparator&&(s=n.highlightSeparator),n.language&&(a=n.language),(n.maxFacets||n.maxfacets==0)&&(h=n.maxFacets),n.parameters&&(u=n.parameters),n.resultProxy&&(l=n.resultProxy),(n.rows||n.rows==0)&&(i=n.rows),n.searchProxy&&(f=n.searchProxy),n.sort&&(o=n.sort),(n.spellcheck||n.spellcheck==!1)&&(y=n.spellcheck),(n.timeout||n.timeout==0)&&(w=n.timeout)))}function it(n,t,i){for(var f,e,u,h,o,r=0,s=n.length;r<s;r++)if(f=n[r],f.id===t){for(e=Object.keys(i),u=0,h=e.length;u<h;u++)o=e[u],f[o]=i[o];break}}function rt(n){for(var t,r,u=n.highlighting,f=Object.keys(u),i=0,a=f.length;i<a;i++){var e=f[i],o=u[e],h=Object.keys(o),c={},l=h.length;if(l>0){for(t=0;t<l;t++)r=h[t],c[r+"_hl"]=s+o[r].join(s)+s;it(n.response.docs,e,c)}}}function ut(n){var r,t,u,i;if(n.response&&n.response.docs&&n.response.docs.length)for(r=n.response.docs,t=0,u=r.length;t<u;t++)i=r[t].type,i&&i.indexOf&&i.indexOf("/")>=0&&(r[t].type_short=i.split("/")[1])}function ft(n){var i,u,r,t;if(n.spellcheck&&n.spellcheck.suggestions&&n.spellcheck.suggestions.length&&(t=n.spellcheck.suggestions.length,i=n.spellcheck.suggestions[t-1].suggestion,i.length)){for(u=[],r=0,t=i.length;r<t;r++)u.push(i[r]);n.suggestions=u}}function et(n){var i,r,t,u;if(l&&n.response&&n.response.docs&&n.response.docs.length)for(i=l,i.indexOf("%%QUERY%%")&&(i=i.replace(/%%QUERY%%/g,encodeURIComponent(b))),r=n.response.docs,t=0,u=r.length;t<u;t++)r[t].proxy_url=i.replace(/%%INDEX%%/g,t)+r[t].url}function ot(n){if(n&&n.response&&(n.response.start||n.response.start===0)&&(n.response.numFound||n.response.numFound===0)&&(n.pager={page:n.response.start/i+1,pages:[],total:Math.ceil(n.response.numFound/i)},i>0))for(var t=0;t<n.response.numFound/i;t++)n.pager.pages.push(t+1)}function st(n){var r,i,t,u;if(n.response&&n.response.maxScore&&n.response.docs&&n.response.docs.length)for(r=n.response.maxScore||1,i=n.response.docs,t=0,u=i.length;t<u;t++)i[t].normalizedScore=i[t].score/r}function ht(n){var e,r,c,l,o,h,t,u,a,s,i,f,v;if(n.spellcheck&&n.spellcheck.suggestions&&n.spellcheck.suggestions.length){for(e=[],r=0,c=n.spellcheck.suggestions.length;r<c;r+=2)if(l=n.spellcheck.suggestions[r],o=n.spellcheck.suggestions[r+1],l=="collation"){for(h="",t="",u=0,a=o.length;u<a;u+=2)if(s=o[u],i=o[u+1],s=="collationQuery")h=t=i;else if(s=="hits")t+=" ("+i+")";else if(s=="misspellingsAndCorrections")for(f=0,v=i.length;f<v;f+=2){var w=i[f],y=i[f+1],p=new RegExp("\\b"+y+"\\b","i");t=t.replace(p,"<em>"+y+"<\/em>")}e.push({query:h,display:t})}e.length>0&&(n.didYouMean=e)}}function ct(n,t,i){var u=v.replace(/%%PROTOCOL%%/ig,d).replace(/%%COLLECTION%%/ig,r).replace(/%%HANDLER%%/ig,t).replace(/%%QUERY%%/ig,i);return f&&f.replace?f.replace(/%%PROTOCOL%%/ig,d).replace(/%%COLLECTION%%/ig,r).replace(/%%HANDLER%%/ig,t).replace(/%%URL%%/ig,u).replace(/%%URLENCODED%%/ig,encodeURIComponent(u)):u}function lt(n){var i,f,t,r,u;if(n&&n.spellcheck&&n.spellcheck.suggestions&&n.spellcheck.collations)for(i=0,f=n.spellcheck.collations.length;i<f;i++)if(t=n.spellcheck.collations[i],typeof t=="object"&&t!=null){r=[];for(u in t)t.hasOwnProperty(u)&&(r.push(u),r.push(t[u]));n.spellcheck.suggestions.push(r)}else n.spellcheck.suggestions.push(t)}function k(n,t){var i=new g,u;return t=t||p||"select",n+="&json.wrf=%%CALLBACK%%",u=ct(r,t,n),console.log("Querying "+u.replace("&json.wrf=%%CALLBACK%%","")),wt(u,w).done(function(n){c&&n.highlighting&&rt(n);t=="suggest"?ft(n):(ut(n),et(n),lt(n),ht(n),st(n),ot(n));i.resolve(n)}).fail(function(n,t,r){i.reject(n,t,r)}),i.promise()}function at(n,r,f){var v,s,l,p;if(b=n,v="q="+encodeURIComponent(n)+(n?"":"&q.alt=*")+"&echoParams=explicit&fl=*,score&defType=edismax&wt=json&start="+r*i+"&rows="+Math.min(i,nt)+(a!==""?"&fq=language:"+a:"")+(y?"&spellcheck=true&spellcheck.collate=true&spellcheck.collateExtendedResults=true":"")+(f&&f.length>0?"&fq="+f.join("&fq="):"")+(e.length>0?"&facet=true&facet.mincount=1&facet.field="+e.join("&facet.field="):"")+(e.length>0&&h>0?"&facet.limit="+h:"")+(o.length>0?"&sort="+o.join(","):"")+(c?"&hl=true&hl.fl=*&hl.snippets=3&hl.simple.pre="+escape("<b>")+"&hl.simple.post="+escape("<\/b>")+"&f.title.hl.fragsize=50000&f.url.hl.fragsize=50000":""),t){if(s=[],t.location?typeof t.location=="string"?s.push("pt="+t.location):s.push("pt="+(t.location.latitude||t.location.lat||0)+","+(t.location.longitude||t.location.lon||0)):s.push("pt=0,0"),s.push("sfield="+(t.field||"custom_p_location")),o.length==0&&s.push("sort=geodist()%20asc"),s.push("fl="+encodeURI(t.outputfield||"_dist_")+":geodist()"),t.range){if(l=t.range,typeof t.range!="number"&&t.range.distance&&(l=t.range.distance,p=t.range.units||t.range.unit,p&&p.toLowerCase))switch(p.toLowerCase()){case"mile":case"miles":l*=1.609344;break;case"metre":case"metres":case"meter":case"meters":l/=1e3}isNaN(l)||s.push("fq={!geofilt%20d%3d"+l+"}")}v+="&"+s.join("&")}return u&&(v=vt(v,u.replace(/^[&]/,""))),k(v)}function vt(n,t){var i=[],e,r,u,s;if(!n)return t;if(!t)return n;for(e=n.split("&"),r=t.split("&"),u=0,s=e.length;u<s;u++){var h=e[u].split("="),f=h[0],c=h[1],o=yt(r,f);if(o>=0){var l=r[o].split("="),a=l[0],v=l[1];",fl,fq,hl.fl,".indexOf(","+f+",")>=0&&i.push(f+"="+c);i.push(a+"="+v);r.splice(o,1)}else i.push(f+"="+c)}return i=i.concat(r),i.join("&")}function yt(n,t){if(!n||!n.length)return-1;for(var i=0,r=n.length;i<r;i++)if(n[i].split("=")[0]===t)return i;return-1}function pt(n){b=n;var t="q="+encodeURIComponent(n)+"&wt=json&spellcheck.collate=false"+(u?"&"+u.replace(/^[&]/,""):"");return k(t,"suggest")}function wt(n,t){function s(n,t,i){n.addEventListener?n.addEventListener(t,i):n.attachEvent&&n.attachEvent("on"+t,function(){i.call(n)})}function e(){f&&(clearTimeout(f),f=null)}function h(){window[u]=c;i&&(i.parentElement.removeChild(i),i=null)}var r=new g,i,o;try{var u="searchg2_"+Math.random().toString().substr(2),c=window[u],f=null;t&&!isNaN(t)&&(f=setTimeout(function(){try{e()}catch(t){}finally{r.reject("timeout",n)}},t));window[u]=function(t){e();r.resolve(t,n)};i=document.createElement("script");o=function(t){e();h();t.type==="error"&&r.reject("error",n)};s(i,"load",o);s(i,"error",o);i.src=n.replace(/%%CALLBACK%%|%25%25CALLBACK%25%25/ig,u);document.getElementsByTagName("head")[0].appendChild(i)}catch(l){r.reject(n,"error",l)}return r.promise()}function g(){var n={args:null,state:"pending",doneList:[],failList:[],alwaysList:[]},t=function(n,t){for(var i=0,r=n.length;i<r;i++)n[i].apply(n[i],t)};return{promise:function(){return{status:function(){return state},done:function(t){return n.state=="resolved"?t.apply(t,n.args):n.doneList.push(t),this},fail:function(t){return n.state=="rejected"?t.apply(t,n.args):n.failList.push(t),this},always:function(t){return n.state=="rejected"||n.state=="resolved"?t.apply(t,n.args):n.alwaysList.push(t),this}}},resolve:function(){n.state==="pending"&&(n.state="resolved",n.args=arguments,t(n.doneList,arguments),t(n.alwaysList,arguments))},reject:function(){n.state==="pending"&&(n.state="rejected",n.args=arguments,t(n.failList,arguments),t(n.alwaysList,arguments))}}}var bt=this,d=location.protocol=="file:"?"http:":location.protocol,f="",v="%%PROTOCOL%%//searchg2.crownpeak.net/%%COLLECTION%%/%%HANDLER%%?%%QUERY%%",nt=200,i=10,r="www.crownpeak.com",u="",e=[],h=5,o=[],y=!1,c=!1,s="...",l="",a="",p="select",b="",w=5e3,t=null;tt(n);typeof console=="undefined"?console={log:function(){}}:console.log||(console.log=function(){});this.rows=function(n){return n!==undefined&&(i=n),i};this.collection=function(n){return n!==undefined&&(r=n),r};this.endpoint=function(n){return n!==undefined&&(v=n),v};this.facets=function(n){return n!==undefined&&(e=typeof n=="string"?[n]:n),e};this.maxFacets=function(n){return n!==undefined&&(h=n),h};this.handler=function(n){return n!==undefined&&(p=n),p};this.highlight=function(n){return n!==undefined&&(c=n),c};this.highlightSeparator=function(n){return n!==undefined&&(s=n),s};this.language=function(n){return n!==undefined&&(a=n),a};this.searchProxy=function(n){return n!==undefined&&(f=n),f};this.spellcheck=function(n){return n!==undefined&&(y=n),y};this.sort=function(n){return n!==undefined&&(o=typeof n=="string"?[n]:n),o};this.timeout=function(n){return n!==undefined&&(w=n),w};this.parameters=function(n){return n!==undefined&&(u=n),u};this.resultProxy=function(n){return n!==undefined&&(l=n),l};this.geo=function(n){return n!==undefined&&(t=n),t};this.query=function(n,t,i){return t||(t=1),at(n,t-1,i)};this.autocomplete=function(n){return pt(n)};this.raw=function(n){return k(n)}}Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(u){if(typeof u!="object"&&(typeof u!="function"||u===null))throw new TypeError("Object.keys called on non-object");var e=[],o,f;for(o in u)t.call(u,o)&&e.push(o);if(i)for(f=0;f<r;f++)t.call(u,n[f])&&e.push(n[f]);return e}}());
//# sourceMappingURL=crownpeak.searchg2-1.0.2.min.js.map